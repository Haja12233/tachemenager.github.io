<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matrice 4x4 - Cases normales</title>
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

    /* Styles Généraux */
    body {
        font-family: 'Poppins', sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        min-height: 100vh;
        padding: 20px;
        background-color: #f8f9fa;
        color: #343a40;
    }

    h1 {
        color: #0d6efd;
        margin-bottom: 30px;
        font-weight: 700;
        text-align: center;
    }

    /* Conteneur de la Matrice */
    #matrix-container {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px; /* Diminué légèrement le gap pour un aspect plus compact */
        width: 100%;
        max-width: 480px; /* Limite la largeur globale de la matrice pour des carrés plus petits */
    }

    /* Cellules de la Matrice */
    .cube-cell {
        width: 100%;
        aspect-ratio: 1 / 1; /* Maintient une forme carrée */
        max-width: 150px; /* Taille maximale des carrés sur les grands écrans */
        background-color: #ffffff;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        margin: 0 auto; /* Centre les cellules dans leur colonne de grille */
    }

    .cube-cell:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 12px rgba(0, 0, 0, 0.1);
    }

    .cube-cell select, .cube-cell button {
        width: 100%;
        height: 100%;
        border: none;
        background-color: transparent;
        font-size: 1.2em; /* Réduit la taille de la police */
        font-weight: 600;
        color: #495057;
        text-align: center;
        cursor: pointer;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        outline: none;
    }

    .cube-cell select {
        background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23495057%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
        background-repeat: no-repeat;
        background-position: right 8px center; /* Ajusté la position de l'icône */
        background-size: 14px; /* Ajusté la taille de l'icône */
        padding-right: 20px; /* Ajusté le padding */
    }

    .empty-cell {
        background-color: #e9ecef;
        border-style: dashed;
    }

    .empty-cell:hover {
        transform: none;
        box-shadow: none;
    }

    /* Boutons Heure */
    .time-button, .stop-button {
        font-weight: 700;
        font-size: 1em; /* Réduit la taille de la police */
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .time-button {
        background-color: #e8f0fe;
        color: #0d6efd;
    }

    .time-button:hover {
        background-color: #d1e3fd;
    }

    .stop-button {
        background-color: #dc3545;
        color: white;
        display: none;
    }

    .stop-button:disabled {
        background-color: #6c757d;
        cursor: not-allowed;
        opacity: 0.65;
    }

    /* Conteneur des Boutons */
    .button-container {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 30px;
        flex-wrap: wrap;
        width: 100%;
        max-width: 700px; /* Limite la largeur pour correspondre à la matrice */
    }

    #submit-btn, #reset-btn {
        padding: 12px 30px; /* Réduit le padding */
        font-size: 16px; /* Réduit la taille de la police */
        font-weight: 600;
        cursor: pointer;
        border: none;
        border-radius: 50px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }

    #submit-btn {
        background: linear-gradient(45deg, #0d6efd, #0b5ed7);
        color: white;
    }

    #submit-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 7px 20px rgba(13, 110, 253, 0.4);
    }

    #reset-btn {
        background: linear-gradient(45deg, #6c757d, #5a6268);
        color: white;
    }

    #reset-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 7px 20px rgba(108, 117, 125, 0.4);
    }

    /* Conteneur des Résultats */
    #result-container {
        margin-top: 40px;
        width: 100%;
        max-width: 700px; /* Cohérent avec la matrice */
        overflow-x: auto;
    }

    .result-sheet {
        border-collapse: collapse;
        border: 1px solid #dee2e6;
        width: 100%;
        max-width: 650px; /* Ajusté pour le tableau */
        margin: auto;
        font-size: 0.85em; /* Réduit la taille de la police du tableau */
    }

    .result-sheet td, .result-sheet th {
        border: 1px solid #dee2e6;
        padding: 10px 6px; /* Réduit le padding du tableau */
        text-align: center;
    }

    .result-sheet thead tr {
        background-color: #eaf3ff;
        color: #0d6efd;
        font-weight: 700;
    }

    .result-sheet th {
        font-weight: 600;
    }

    .result-sheet tbody tr:nth-child(even) {
        background-color: #f6f8fb;
    }

    /* Media Queries pour la Responsivité */

    @media (max-width: 768px) {
        /* Écrans de tablette et petits ordinateurs */
        h1 {
            font-size: 1.4em;
        }
        
        #matrix-container {
            grid-template-columns: repeat(2, 1fr); /* 2 colonnes sur tablette */
            gap: 10px;
            max-width: 400px; /* Limite la largeur de la matrice sur tablette */
        }

        .cube-cell {
            max-width: 100%; /* Permet aux cellules de prendre la largeur disponible dans les colonnes */
            height: 100px; /* Hauteur fixe pour les cellules sur tablette */
        }

        .cube-cell select, .cube-cell button {
            font-size: 0.9em; /* Réduit la taille de la police */
        }

        .cube-cell select {
            background-position: right 5px center;
            background-size: 12px;
            padding-right: 15px;
        }

        .button-container {
            flex-direction: column;
            align-items: center;
            gap: 10px;
            max-width: 400px;
        }

        #submit-btn, #reset-btn {
            width: 100%;
            max-width: 250px; /* Limite la largeur des boutons */
            padding: 10px 15px;
            font-size: 15px;
        }

        .result-sheet {
            font-size: 0.8em;
        }
    }

    @media (max-width: 480px) {
        /* Écrans de téléphone */
        h1 {
            font-size: 1.2em;
        }
        
        #matrix-container {
            grid-template-columns: 1fr; /* Une seule colonne */
            gap: 8px;
            max-width: 250px; /* Limite la largeur de la matrice sur téléphone */
        }

        .cube-cell {
            height: 80px; /* Hauteur fixe plus petite pour les cellules sur téléphone */
        }

        .cube-cell select, .cube-cell button {
            font-size: 0.8em; /* Réduit encore la taille de la police */
        }

        .button-container {
            max-width: 250px;
        }

        #submit-btn, #reset-btn {
            max-width: 200px;
            font-size: 14px;
        }

        .result-sheet {
            font-size: 0.7em;
        }
        .result-sheet td, .result-sheet th {
            padding: 8px 4px; /* Encore moins de padding pour le tableau */
        }
    }
    </style>
</head>
<body>

    <h1>GESTION des TACHES</h1>
    
    <div id="matrix-container">
        <div class="cube-cell"><select id="A1"><option value="">--</option><option value="A">A</option><option value="T">T</option></select></div>
        <div class="cube-cell"><button id="start-time-btn" class="time-button"></button></div>
        <div class="cube-cell"><button id="end-time-btn" class="stop-button"></button></div>
        <div class="cube-cell"><select id="A4"><option value="">--</option><option value="01">01</option><option value="02">02</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="20">20</option><option value="21">21</option><option value="22">22</option></select></div>
        <div class="cube-cell empty-cell"></div>
        <div class="cube-cell empty-cell"></div>
        <div class="cube-cell empty-cell"></div>
        <div class="cube-cell"><select id="B4"><option value="">--</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select></div>
        <div class="cube-cell empty-cell"></div>
        <div class="cube-cell"><select id="C2"><option value="">--</option><option value="R">R</option><option value="R_round">R_round</option><option value="2R">2R</option><option value="2R_round">2R_round</option><option value="3R">3R</option><option value="3R_round">3R_round</option></select></div>
        <div class="cube-cell"><select id="C3"><option value="">--</option><option value="X">X</option><option value="X_round">X_round</option></select></div>
        <div class="cube-cell"><select id="C4"><option value="">--</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select></div>
        <div class="cube-cell"><select id="D1"><option value="">--</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option></select></div>
        <div class="cube-cell empty-cell"></div>
        <div class="cube-cell empty-cell"></div>
        <div class="cube-cell"><select id="D4"><option value="">--</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select></div>
    </div>

    <div class="button-container">
        <button id="submit-btn">Afficher le résultat</button>
        <button id="reset-btn">Actualiser</button>
    </div>

    <div id="result-container"></div>

	<script>
	    document.addEventListener('DOMContentLoaded', function() {
	    const startTimeBtn = document.getElementById('start-time-btn');
	    const endTimeBtn = document.getElementById('end-time-btn');
	    const resultContainer = document.getElementById('result-container');
	    const submitBtn = document.getElementById('submit-btn');
	    const resetBtn = document.getElementById('reset-btn');

	    // Mappage des champs et de leur champ "débloquant"
	    const fields = [
	        { id: 'A1', next: ['A4', 'start-time-btn'] },
	        { id: 'A4', next: 'B4' },
	        { id: 'B4', next: 'C2' },
	        { id: 'C2', next: 'C3' },
	        { id: 'C3', next: 'C4' },
	        { id: 'C4', next: 'D1' },
	        { id: 'D1', next: 'D4' },
	        { id: 'D4', next: ['end-time-btn', 'submit-btn'] }
	    ];

	    let startTime = null;
	    let endTime = null;

	    // Fonction pour désactiver toutes les cases sauf la première au démarrage
	    function disableAllFields() {
	        const allSelects = document.querySelectorAll('#matrix-container select');
	        allSelects.forEach(select => {
	            select.disabled = true;
	        });
	        document.getElementById('A1').disabled = false;
	        startTimeBtn.disabled = true;
	        endTimeBtn.style.display = 'none';
	        submitBtn.disabled = true;
	    }

	    // Fonction pour activer les champs suivants
	    function enableNextField(currentId) {
	        const currentField = fields.find(f => f.id === currentId);
	        if (currentField && currentField.next) {
	            const nextElements = Array.isArray(currentField.next) ? currentField.next : [currentField.next];
	            
	            nextElements.forEach(nextId => {
	                const nextElement = document.getElementById(nextId);
	                if (nextElement) {
	                    if (nextElement.tagName === 'SELECT' || nextElement.tagName === 'BUTTON') {
	                        nextElement.disabled = false;
	                    }
	                    if (nextId === 'end-time-btn' || nextId === 'submit-btn') {
	                        nextElement.style.display = 'block';
	                    }
	                }
	            });
	        }
	    }

	    // Initialisation : désactiver tous les champs au chargement
	    disableAllFields();

	    // Événements de changement pour l'enchaînement des cases
	    fields.forEach(field => {
	        const selectElement = document.getElementById(field.id);
	        if (selectElement) {
	            selectElement.addEventListener('change', function() {
	                if (this.value !== "") {
	                    enableNextField(this.id);
	                } else {
	                    const currentIndex = fields.findIndex(f => f.id === this.id);
	                    for (let i = currentIndex + 1; i < fields.length; i++) {
	                        const nextId = fields[i].id;
	                        const nextElement = document.getElementById(nextId);
	                        if (nextElement) {
	                            nextElement.disabled = true;
	                            nextElement.value = '';
	                        }
	                    }
	                    endTimeBtn.style.display = 'none';
	                    submitBtn.disabled = true;
	                }
	            });
	        }
	    });

	    // Événements pour les boutons de temps
	    startTimeBtn.addEventListener('click', function() {
	        if (startTime === null) {
	            startTime = getFormattedTime();
	            this.textContent = startTime;
	            this.disabled = true;
	            this.style.cursor = 'default';
	        }
	    });

	    endTimeBtn.addEventListener('click', function() {
	        if (endTime === null) {
	            endTime = getFormattedTime();
	            this.textContent = endTime;
	            this.disabled = true;
	            this.style.cursor = 'default';
	        }
	    });

	    // Fonction de validation
	    const requiredFields = fields.map(f => f.id);
	    function areAllFieldsFilled() {
	        const isFormFilled = requiredFields.every(fieldId => !!document.getElementById(fieldId).value);
	        return isFormFilled && startTime && endTime;
	    }

	    function getFormattedTime() {
	        const now = new Date();
	        const hours = now.getHours().toString().padStart(2, '0');
	        const minutes = now.getMinutes().toString().padStart(2, '0');
	        const seconds = now.getSeconds().toString().padStart(2, '0');
	        return `${hours}:${minutes}:${seconds}`;
	    }

	    // Fonction pour envoyer les données à Google Sheets
	    async function sendDataToSheets(values) {
	        // ⚠️ REMPLACEZ CETTE URL PAR VOTRE URL DE WEBHOOK ⚠️
	        const WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbwB2VRIvvhEfRD9SuXaLW2qmnS1T3zqWIBD_vjyrHXKqNgy28cWsefCi-wt9g4Oc-b5/exec';
	        
	        try {
	            console.log('Envoi des données:', values);
	            
	            const response = await fetch(WEBHOOK_URL, {
	                method: 'POST',
	                headers: {
	                    'Content-Type': 'application/json',
	                },
	                body: JSON.stringify(values),
	                mode: 'no-cors' // Pour éviter les erreurs CORS en développement
	            });
	            
	            // Avec mode: 'no-cors', on ne peut pas lire la réponse
	            // Mais la requête est envoyée quand même
	            console.log('Requête envoyée');
	            
	            // Attendre un peu pour que Google Apps Script traite la requête
	            await new Promise(resolve => setTimeout(resolve, 2000));
	            
	            return true;
	            
	        } catch (error) {
	            console.error('Erreur détaillée:', error);
	            return true; // On considère que c'est ok même en cas d'erreur CORS
	        }
	    }

		submitBtn.addEventListener('click', async function() {
		    if (areAllFieldsFilled()) {
		        const values = {
		            date: new Date().toLocaleDateString('fr-FR'),
		            A1: document.getElementById('A1').value,
		            A2_start: startTime,
		            A3_end: endTime,
		            A4: document.getElementById('A4').value,
		            B4: document.getElementById('B4').value,
		            C2: document.getElementById('C2').value,
		            C3: document.getElementById('C3').value,
		            C4: document.getElementById('C4').value,
		            D1: document.getElementById('D1').value,
		            D4: document.getElementById('D4').value,
		        };

		        // Envoyer vers Google Sheets
		        const success = await sendDataToSheets(values);
		        
		        // Afficher message de succès
		        resultContainer.innerHTML = `
		            <div style="text-align: center; padding: 20px; background-color: #d4edda; border: 1px solid #c3e6cb; border-radius: 8px; color: #155724;">
		                <h2>✅ Données envoyées vers Google Sheets !</h2>
		                <p>Les données ont été enregistrées dans votre feuille Google Sheets.</p>
		                <button id="send-again-btn" style="padding: 10px 20px; background: #0d6efd; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;">Soumettre à nouveau</button>
		            </div>
		        `;
		        
		        // Ajouter événement pour soumettre à nouveau
		        document.getElementById('send-again-btn').addEventListener('click', function() {
		            resetBtn.click();
		        });

		    } else {
		        alert('Veuillez remplir toutes les cases et enregistrer les heures de début et de fin.');
		    }
		});

	    resetBtn.addEventListener('click', function() {
	        document.querySelectorAll('select').forEach(select => {
	            select.selectedIndex = 0;
	        });
	        startTime = null;
	        endTime = null;
	        startTimeBtn.textContent = 'Heure de début';
	        startTimeBtn.disabled = true;
	        startTimeBtn.style.cursor = 'default';
	        endTimeBtn.textContent = 'Heure de fin';
	        endTimeBtn.disabled = true;
	        endTimeBtn.style.cursor = 'default';
	        endTimeBtn.style.display = 'none';
	        submitBtn.disabled = true;
	        resultContainer.innerHTML = '';
	        disableAllFields();
	    });
	});
	</script>
</body>
</html>
